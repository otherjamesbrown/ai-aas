# Contract: Environment Access Packages

**Branch**: `001-infrastructure`  
**Date**: 2025-11-08  
**Spec**: `/specs/001-infrastructure/spec.md`

## Overview

Platform engineers distribute access packages to application teams and automation actors. Each package is immutable per release and contains a kubeconfig, RBAC role bindings, and observability bookmarks. Packages are generated by `scripts/infra/access-package.sh` and stored in Linode Object Storage with time-limited signed URLs.

## Artifacts

| Artifact | Format | Description | Retention |
|----------|--------|-------------|-----------|
| `kubeconfig.yaml` | YAML | Namespaced kubeconfig limited to target environment; embeds short-lived client certificate | 24 hours |
| `rbac.json` | JSON | Role and ClusterRoleBinding summary granting verbs per resource group | 90 days |
| `observability-links.json` | JSON | Dashboard, alert channel, and log query URLs scoped to environment | 90 days |
| `handoff.pdf` | PDF | Human-readable instructions generated from `quickstart.md` | 90 days |

## Package Schema

```json
{
  "environment": "development",
  "role": "app-team",
  "expires_at": "2025-11-09T18:30:00Z",
  "issued_by": "platform@ai-aas.dev",
  "kubeconfig_url": "https://object-storage.example/pkg/dev/app-team/kubeconfig.yaml?signature=...",
  "rbac_url": "https://object-storage.example/pkg/dev/app-team/rbac.json?signature=...",
  "observability_links_url": "https://object-storage.example/pkg/dev/app-team/observability-links.json?signature=...",
  "support_channel": "slack://#platform-infra"
}
```

## Contract Guarantees

1. **Time-bounded credentials**: `expires_at` must be ≤24 hours for non-production roles and ≤8 hours for production access.  
2. **Namespace confinement**: Generated kubeconfigs include `--namespace` defaults and cannot escalate beyond assigned namespace.  
3. **Auditability**: Every package issuance produces an audit event (`access_package_issued`) in Loki with actor, environment, and expiration metadata.  
4. **Revocation**: Revoking an access package triggers secret rotation via `scripts/infra/secrets/rotate.sh`, invalidating kubeconfig certificates.  
5. **Observability parity**: `observability-links.json` contains URLs to Grafana dashboards, Loki queries, and Tempo traces with query parameters preset to the environment label.

## API References

Access packages are described by the OpenAPI contract in `service-handoff-openapi.yaml` (`GET /v1/environments/{environment}/handoff`). The response body mirrors the schema above and includes additional deployment steps for teams.

